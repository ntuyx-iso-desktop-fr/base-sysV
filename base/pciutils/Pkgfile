description="PCI bus configuration space access library and tools"
url="http://atrey.karlin.mff.cuni.cz/~mj/pciutils.html"
contributors="Pierre B"
packager="tnut <tnut@nutyx.org>"

name=pciutils
version=3.6.2

source=(https://www.kernel.org/pub/software/utils/pciutils/$name-$version.tar.xz)

PKGMK_GROUPS=(devel man)

build() {
cd $name-$version
make OPT="$CFLAGS -fPIC -DPIC" \
ZLIB=no \
PREFIX=/usr \
SHAREDIR=/usr/share/misc \
MANDIR=/usr/share/man \
SHARED=yes all

mkdir -p $PKG/usr/share/man
mkdir -p $PKG/usr/lib
make PREFIX=$PKG/usr \
SHAREDIR=$PKG/usr/share/misc \
MANDIR=$PKG/usr/share/man \
SHARED=yes ZLIB=no \
install install-lib
chmod -v 755 $PKG/usr/lib/libpci.so.$version

cat > $PKG/lib/systemd/system/update-pciids.service << "EOF" &&
[Unit]
Description=Update pci.ids file
Documentation=man:update-pciids(8)
DefaultDependencies=no
After=local-fs.target network-online.target
Before=shutdown.target

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/sbin/update-pciids
EOF

cat > $PKG/lib/systemd/system/update-pciids.timer << "EOF" &&
[Unit]
Description=Update pci.ids file weekly

[Timer]
OnCalendar=Sun 02:30:00
Persistent=true

[Install]
WantedBy=timers.target
EOF
}
